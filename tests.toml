test_format = 1.0

[default]

# GTS don't support it
exclude = [ "change_url" ]

# ------------
# Tests to run
# ------------

preinstall = """
sudo yunohost tools update apps
sudo yunohost domain add gts.domain.tld
sudo yunohost app install https://github.com/YunoHost-Apps/gotosocial_ynh/tree/testing -f -a "domain=gts.domain.tld&admin=xana&email=ci-test@example.com&password=vYh8io7r*@P&zyo!6ZhBqQQ%8M5D4M&"
"""

preupgrade = """
sudo yunohost app remove gotosocial__2 || true
sudo yunohost app upgrade gotosocial -u https://github.com/YunoHost-Apps/gotosocial_ynh/tree/testing -F
"""

# -------------------------------
# Default args to use for install
# -------------------------------

args.admin = "xana"
args.domain = "sub.domain.tld"
args.account_domain = "sub.domain.tld"
args.email = "ci-test@example.com"
args.password = "vYh8io7r*@P&zyo!6ZhBqQQ%8M5D4M"
# false by default
args.accounts_registration_open = 1
# true by default
args.accounts_reason_required = 0

# -------------------------------
# Commits to test upgrade from
# -------------------------------

test_upgrade_from.b7237d51.name = "Upgrade from 0.17.0~ynh1 (first beta release)"

# -------------------------------
# additional tests suite
# -------------------------------

[nowasm_test]
only = ["install.root"]
preinstall = "touch /var/www/nowasm_test"
args.admin = "xana"
args.email = "ci-test@example.com"
args.password = "vYh8io7r*@P&zyo!6ZhBqQQ%8M5D4M"
args.accounts_registration_open = 1
args.accounts_reason_required = 0

[account_domain_test]
only = ["install.root"]
args.admin = "xana"
args.domain = "sub.domain.tld"
args.account_domain = "domain.tld"
args.email = "ci-test@example.com"
args.password = "vYh8io7r*@P&zyo!6ZhBqQQ%8M5D4M"
args.accounts_registration_open = 1
args.accounts_reason_required = 0
